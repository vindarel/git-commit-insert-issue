[[http://melpa.org/#/git-commit-insert-issue][file:http://melpa.org/packages/git-commit-insert-issue-badge.svg]]

* Search and insert the right issue at "Fixes #"

Goal: In a magit commit buffer, I want to complete the issue when I type
"Fixes #".

For Github and Gitlab (/Gitlab is usuable but uncomplete, see below/).

I was jealous about a SublimeText plugin, this is now done with Helm.

#+BEGIN_HTML
 <img src="https://gitlab.com/emacs-stuff/git-commit-insert-issue/raw/master/img.png" </img>
#+END_HTML
# https://cloud.githubusercontent.com/assets/5016978/6471672/e36e8c00-c1a1-11e4-91a1-dd5481d57c36.png

** Usage
Activate the minor mode
: M-x git-commit-insert-issue-mode

In a magit  commit buffer (=git-commit-mode=), type "Fixes  #" (or [[https://help.github.com/articles/closing-issues-via-commit-messages/][any
other keyword understood by github]]) and choose the issue from the helm
list.

So to always activate it:
: (add-hook 'git-commit-mode-hook 'git-commit-insert-issue-mode)

*** Connect to your Gitlab account
Don't forget to set your gitlab credentials:
#+BEGIN_SRC emacs-lisp
(setq gitlab-host "https://gitlab.com"
        gitlab-username "foo"
        gitlab-password "password")
#+END_SRC
and to call =M-x gitlab-login=.

** Installation

This package is in [[http://wikemacs.org/wiki/MELPA][MELPA]], so you can install it with [[http://wikemacs.org/wiki/Package.el][package.el]]:

: M-x package-install RET git-commit-insert-issue RET

(you may need a =M-x package-refresh-contents=).

Alternatively, you can download this  repo and call =M-x load-file= on the
elisp source.

*** Dependencies

- [[https://github.com/inkel/github-issues.el][github-issues]]
- helm
- projectile
- s.el

They are all in MELPA.

** Issues

- if you play too much with it, you can reach github's rate limit.

[[https://github.com/inkel/github-issues.el/issues][Issues of github-issues.el]] :

# export: both uses an org table with many columns. Eval with C-c-c
#+BEGIN_SRC emacs-lisp
(--map (insert (concat it "\n")) (git-commit-insert-issue-github-issues-format "inkel" "github-issues.el"))#5 - Add autoload marker
#4 - Declare buffer local variables as global variable
#3 - Add package footer for packaging convention
#1 - Doesn't work on private repos.
#+END_SRC


#+BEGIN_SRC emacs-lisp :exports none
;;(issues-get-issues "inkel" "github-issues.el")
#+END_SRC



** Todo

- tests
- cache
- gitlab integration:  WIP
  - [X] Get opened issues from gitlab
  - [X] Get a list of strings with "id - title"
  - [X] choose with ido and insert in buffer: =M-x git-commit-insert-issue-gitlab-insert=.
  - [ ] choose github or gitlab, depending on project.
    - [X] get the remote server in git config
  - [X]  make it work for  projects in groups (i.e,  "emacs-stuff/project" and
    not "vindarel".
    - [X] get the group name in git config
  - [ ] error handling (bad project name, etc)
